<div class="container my-3">
  <h1 class="text-center m-3"><%= "#{@guest.first_name} #{@guest.last_name}さんの詳細" %></h1>
  <%# 利用者の詳細テーブル %>
  <div class="container">
    <div class="text-center my-3">
    <% if @guest.image.attached? %>
      <%= image_tag @guest.image.variant(resize_to_fit: [256, 256]), class: 'guest-image rounded img-thumbnail', alt: '顔写真' %>
    <% else %>
    <% end %>
    </div>
    <table class="table table-bordered">
      <caption>利用者の詳細</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">名前</th>
          <th scope="col">性別</th>
          <th scope="col">利用日１</th>
          <th scope="col">利用日２</th>
          <th scope="col">歩行状態</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td scope="col"><%= "#{@guest.first_name} #{@guest.last_name} (#{@guest.first_name_kana} #{@guest.last_name_kana})" %></td>
          <td scope="col"><%= @guest.gender.name %></td>
          <td scope="col"><%= @guest.visit1.name %></td>
          <td scope="col"><%= @guest.visit2.name %></td>
          <td scope="col"><%= @guest.adl.name %></td>
        </tr>
      </tbody>
      <thead class="thead-dark">
        <tr>
          <th colspan="12">利用者の備考</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="12"><%= @guest.description %></td>
        </tr>
      </tbody>
    </table>
  </div>
  <%# /利用者の詳細テーブル %>
  <%# 利用者の入浴詳細テーブル %>
  <div class="container">
    <table class="table table-bordered">
      <caption>入浴の詳細</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">入浴形態</th>
          <th scope="col">感染症</th>
          <th scope="col">入浴の順番</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td scope="col"><%= @guest.bath.bathing.name %></td>
          <td scope="col"><%= @guest.bath.infection.name %></td>
          <td scope="col"><%= @guest.bath.timing.name %></td>
        </tr>
      </tbody>
      <thead class="thead-dark">
        <tr>
          <th colspan="12">入浴の備考</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="12"><%= @guest.bath.remark_bath %></td>
        </tr>
      </tbody>
    </table>
  </div>
  <%# /利用者の入浴詳細テーブル %>
  <%# 利用者の水分詳細テーブル %>
  <div class="container">
    <table class="table table-bordered">
      <caption>水分の詳細</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">飲み物の種類</th>
          <th scope="col">とろみの量</th>
          <th scope="col">温めの有無</th>
          <th scope="col">糖尿病の有無</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td scope="col"><%= @guest.drink.drink_type.name %></td>
          <td scope="col"><%= @guest.drink.thickness.name %></td>
          <td scope="col"><%= @guest.drink.warm ? "温める" : "温めない"  %></td>
          <td scope="col"><%= @guest.drink.diabetes ? "あり" : "なし"  %></td>
        </tr>
      </tbody>
      <thead class="thead-dark">
        <tr>
          <th colspan="12">水分の備考</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="12"><%= @guest.drink.remark_drink %></td>
        </tr>
      </tbody>
    </table>
  </div>
  <%# /利用者の水分詳細テーブル %>
  <%# 利用者の食事詳細テーブル %>
  <div class="container">
    <table class="table table-bordered">
      <caption>食事の詳細</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">主食の形態</th>
          <th scope="col">主菜の形態</th>
          <th scope="col">副菜の形態</th>
          <th scope="col" colspan="3">禁止食材</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td scope="col"><%= @guest.food.staple_type.name %></td>
          <td scope="col"><%= @guest.food.main_dish_type.name %></td>
          <td scope="col"><%= @guest.food.side_dish_type.name %></td>
          <td scope="col" colspan="3"><%= @guest.food.banned_food %></td>
        </tr>
      </tbody>
      <thead class="thead-dark">
        <tr>
          <th scope="col">主食の量</th>
          <th scope="col">主菜の量</th>
          <th scope="col">副菜の量</th>
          <th scope="col">義歯</th>
          <th scope="col">汁物のとろみ</th>
          <th scope="col">塩分制限</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td scope="col"><%= @guest.food.staple_amount.name %></td>
          <td scope="col"><%= @guest.food.main_dish_amount.name %></td>
          <td scope="col"><%= @guest.food.side_dish_amount.name %></td>
          <td scope="col"><%= @guest.food.denture.name %></td>
          <td scope="col"><%= @guest.food.soup_thick ? "あり" : "なし" %></td>
          <td scope="col" ><%= @guest.food.low_salt ? "あり" : "なし" %></td>
        </tr>
      </tbody>
      <thead class="thead-dark">
        <tr>
          <th colspan="12">食事の備考</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="12"><%= @guest.food.remark_food %></td>
        </tr>
      </tbody>
      <thead class="thead-dark">
        <tr>
          <th colspan="12">禁止食材タグ</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="12"><% @guest.food.forbids.each do |x| %>
            <%= x.forbid_food %>
          <% end %></td>
        </tr>
      </tbody>
    </table>
  </div>
  <%# /利用者の食事詳細テーブル %>
  <%# 利用者の更新履歴テーブル %>
  <div class="container">
    <table class="table table-bordered">
      <caption>更新履歴</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">理由</th>
          <th scope="col">更新内容</th>
          <th scope="col">日付</th>
        </tr>
      </thead>
      <tbody>
        <% @histories.each do |history| %>
          <tr>
            <td scope="col" style="width:30%"><%= history.log_type.name %></td>
            <td scope="col" style="width:50%"><%= history.log %></td>
            <td scope="col" style="width:20%"><%= history.created_at.strftime('%Y/%m/%d') %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%# /利用者の更新履歴テーブル %>
  <%# 利用者のコメントテーブル %>
  <div class="container">
    <table class="table table-bordered">
      <caption>コメント</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">日付</th>
          <th scope="col">本文</th>
          <th scope="col">編集/削除</th>
        </tr>
      </thead>
      <tbody>
        <% @comments.each do |comment| %>
          <tr>
            <td scope="col" style="width:20%"><%= comment.created_at.strftime('%Y/%m/%d') %></td>
            <td scope="col" style="width:55%"><%= comment.text %></td>
            <td scope="col" style="width:25%">

              <!-- Button trigger modal -->
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#commentEdit-<%= "#{comment.id}" %>" id="edit-start-<%= "#{comment.id}" %>">
                編集
              </button>

              <!-- Modal -->
              <div class="modal fade" id="commentEdit-<%= "#{comment.id}" %>" tabindex="-1" role="dialog" aria-labelledby="commentEdit-<%= "#{comment.id}" %>Title" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="commentEdit-<%= "#{comment.id}" %>Title">コメント編集フォーム</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <%= form_with(model: comment, url: "/guests/#{comment.guest_id}/comments/#{comment.id}", method: :patch, local: true) do |f| %>
                        <div class="form-row my-3">
                          <div class="form-group col-sm-12">
                            <label for="edit-text">本文<span class="text-danger pl-3">必須</span></label>
                            <%= f.text_area :text, class:"form-control", id:"edit-text" %>
                          </div>
                        </div>
                        <%# 登録ボタン %>
                        <div class="form-row my-3">
                          <div class="form-group col-sm-12 modal-footer">
                            <%= f.submit "コメントを編集する" ,class:"btn btn-primary", role: "button" %>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">編集を中止する</button>
                          </div>
                        </div>
                        <%# /登録ボタン %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /Modal -->
              <%= link_to '削除', guest_comment_path(comment.guest.id, comment.id), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger", role: "button" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%# /利用者のコメントテーブル %>
  <%# 編集あるいは削除ボタン %>
  <div class="row">
      <div class="col">
              <!-- Button trigger modal -->
              <button type="button" class="btn btn-success btn-block btn-lg" data-toggle="modal" data-target="#commentNew">
                <i class="far fa-comment-dots"></i> コメントをする
              </button>

              <!-- Modal -->
              <div class="modal fade" id="commentNew" tabindex="-1" role="dialog" aria-labelledby="commentNewTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="commentNewTitle">コメントフォーム</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <%= form_with(model: [@guest, @comment_new], local: true) do |f| %>
                        <div class="form-row my-3">
                          <div class="form-group col-sm-12">
                            <label for="text">本文<span class="text-danger pl-3">必須</span></label>
                            <%= f.text_area :text, class:"form-control", id:"text" %>
                          </div>
                        </div>
                        <%# 登録ボタン %>
                        <div class="form-row my-3">
                          <div class="form-group col-sm-12 modal-footer">
                            <%= f.submit "コメントをする" ,class:"btn btn-primary", role: "button" %>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">中止する</button>
                          </div>
                        </div>
                        <%# /登録ボタン %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /Modal -->
    </div>
    <div class="col">
      <%= link_to edit_guest_path(edit_jump(@guest.id)), method: :get, class: "btn btn-primary btn-block btn-lg", role: "button" do %>
      <i class="fas fa-edit"></i> 編集
      <% end %>
    </div>
    <div class="col">
      <%= link_to guest_path(@guest.id), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger btn-block btn-lg", role: "button" do %>
      <i class="far fa-trash-alt"></i> 削除
      <% end %>
    </div>
  </div>
  <%# /編集あるいは削除ボタン %>
</div>